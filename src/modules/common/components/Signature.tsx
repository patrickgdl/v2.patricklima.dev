import React, { forwardRef, useEffect, useRef } from 'react';

const Signature = ({
  animationDuration = 2,
}: {
  animationDuration: number;
}) => {
  const svgRef = useRef<SVGSVGElement>(null);
  const sigLineRef = useRef<SVGPathElement>(null);
  const dotRef = useRef<SVGPathElement>(null);

  useEffect(() => {
    if (sigLineRef.current && dotRef.current && svgRef.current) {
      // get all SVG elements ref - lines and dots
      const sigLineElement = sigLineRef.current;
      const dotElement = dotRef.current;

      const paths = [sigLineElement, dotElement];

      // prepare path length variable
      let len = 0;
      // prepare animation delay length variable
      let delay = 0;

      // set duration in seconds of animation to default if not set
      const totalDuration = animationDuration || 2;

      // calculate the full path length
      paths.forEach((path) => {
        if (path) {
          const totalLen = path.getTotalLength();
          len += totalLen;
        }
      });

      paths.forEach((path) => {
        if (path) {
          const pathElem = path;
          // get current path length
          const totalLen = path.getTotalLength();
          // calculate current animation duration
          const duration = (totalLen / len) * totalDuration;

          // set animation duration and delay
          pathElem.style.animationDuration = `${
            duration < 0.2 ? 0.2 : duration
          }s`;
          pathElem.style.animationDelay = `${delay}s`;

          // set dash array and offset to path length - this is how to hide the line
          pathElem.setAttribute('stroke-dasharray', String(totalLen));
          pathElem.setAttribute('stroke-dashoffset', String(totalLen));

          // set delay for the next path - added .2 seconds to make it more realistic
          delay += duration + 0.2;
        }
      });

      // set 'animated' class to parent SVG which will start the animation
      svgRef.current.classList.add('animated');
    }
  }, [animationDuration]);

  return (
    <svg
      ref={svgRef}
      width='86'
      height='88'
      viewBox='0 0 86 88'
      fill='none'
      xmlns='http://www.w3.org/2000/svg'
    >
      <SignatureLine ref={sigLineRef} />
      <SignatureDot ref={dotRef} />
    </svg>
  );
};

export default Signature;

export const SignatureLine = forwardRef<SVGPathElement>((props, ref) => (
  <path
    ref={ref}
    className='signature__path'
    d='M16.8813 1.28467C16.8813 1.49878 16.8412 1.71289 16.7609 1.927C16.6806 2.14112 16.6304 2.36861 16.6103 2.60949C16.5903 2.85036 16.5777 3.48268 16.5727 4.50637C16.5677 5.53012 16.5646 6.77211 16.5633 8.23243C16.562 9.69275 16.5613 11.0872 16.561 12.4158C16.5606 13.7443 16.6006 15.2572 16.6808 16.9543C16.761 18.6514 16.8111 19.8727 16.8312 20.6181C16.8513 21.3636 16.9039 22.2711 16.9892 23.3406C17.0745 24.4102 17.168 25.5203 17.2696 26.6709C17.3712 27.8216 17.5552 29.4239 17.8215 31.478C18.0878 33.5322 18.2943 35.1772 18.4412 36.4134C18.588 37.6495 18.72 38.6227 18.837 39.3331C18.954 40.0439 19.0271 40.7687 19.0564 41.5084C19.0856 42.248 19.2243 43.5134 19.4725 45.3043C19.7207 47.0948 19.9963 48.8965 20.2992 50.7092C20.6021 52.5219 20.7914 53.8557 20.8672 54.7103C20.9429 55.5649 21.0304 56.7012 21.1296 58.1192C21.2288 59.5371 21.331 60.7447 21.4361 61.7413C21.5412 62.7382 21.647 63.6423 21.7536 64.4536C21.8602 65.2648 21.9669 66.2939 22.0739 67.5403C22.1808 68.7871 22.2878 69.9677 22.3948 71.0822C22.5018 72.1966 22.5687 72.9735 22.5955 73.4129C22.6222 73.8522 22.6389 74.6484 22.6456 75.802C22.6523 76.9557 22.6966 77.8373 22.7786 78.4469C22.8606 79.0564 22.9118 79.5176 22.9323 79.8308C22.9528 80.1436 22.9656 80.7406 22.9707 81.6219C22.9758 82.5032 22.979 83.4552 22.9803 84.4784C22.9816 85.5016 22.9824 86.1411 22.9827 86.397C22.983 86.6527 22.9833 86.7725 22.9833 86.7561C22.9834 86.7397 22.9433 86.6093 22.863 86.3643C22.7827 86.1192 22.7326 85.8857 22.7125 85.6641C22.6925 85.4422 22.6398 85.3035 22.5545 85.2482C22.4692 85.1927 22.3757 85.0777 22.2741 84.9033C22.1724 84.7289 22.1089 84.5394 22.0835 84.3351C22.0581 84.1312 22.0021 84.0034 21.9155 83.9523C21.8288 83.9013 21.7747 83.7892 21.753 83.6157C21.7313 83.4426 21.6777 83.3341 21.592 83.2907C21.5062 83.2474 21.4527 83.1401 21.4312 82.9686C21.4098 82.7974 21.3563 82.6901 21.2706 82.6474C21.185 82.6044 21.0913 82.4974 20.9896 82.3259C20.8879 82.1547 20.744 81.9274 20.558 81.6434C20.372 81.3598 20.2558 81.1424 20.2093 80.9912C20.1628 80.8399 20.1337 80.7053 20.1221 80.5871C20.1104 80.4693 20.063 80.3954 19.9799 80.3658C19.8966 80.3363 19.8045 80.2775 19.7034 80.1898C19.6023 80.1022 19.5391 80.0074 19.5139 79.9053C19.4886 79.8028 19.3524 79.5783 19.1051 79.2318C18.858 78.8849 18.5429 78.4276 18.1599 77.8591C17.777 77.2907 17.4974 76.9354 17.3214 76.7932C17.1454 76.6512 16.9952 76.482 16.8709 76.286C16.7466 76.0898 16.5886 75.8868 16.397 75.6774C16.2053 75.4677 16.0052 75.2564 15.7967 75.0434C15.5882 74.8305 15.4178 74.5768 15.2854 74.2826C15.153 73.9887 15.03 73.8047 14.9166 73.7312C14.8033 73.6576 14.6922 73.5715 14.5836 73.4729C14.4749 73.3743 14.3669 73.2725 14.2595 73.1675C14.152 73.0625 14.0848 72.9568 14.058 72.8502C14.0311 72.7439 13.9742 72.6771 13.8872 72.6504C13.8002 72.6238 13.7056 72.5672 13.6036 72.4802C13.5015 72.3932 13.3976 72.2987 13.2918 72.1966C13.186 72.0948 13.0798 71.9506 12.973 71.7646C12.8663 71.5784 12.7193 71.422 12.532 71.2951C12.3447 71.1682 12.1474 71.0086 11.94 70.8165C11.7326 70.6242 11.2818 70.223 10.5876 69.6128C9.89341 69.0029 9.29896 68.5009 8.80424 68.1075C8.30954 67.7141 7.83977 67.3479 7.39492 67.0088C6.95007 66.6693 6.31072 66.2165 5.47687 65.6499C4.64306 65.0834 4.1219 64.6893 3.91343 64.4674C3.70497 64.2455 3.49439 64.0666 3.28169 63.9307C3.06899 63.7949 2.89591 63.6699 2.76245 63.5556C2.62898 63.4416 2.54556 63.3298 2.51219 63.2209C2.47883 63.1121 2.49812 63.0041 2.57007 62.8966C2.64202 62.789 2.72714 62.7218 2.82542 62.6949C2.92369 62.6682 3.02527 62.6512 3.13013 62.6444C3.23499 62.6377 3.78228 62.6335 4.77201 62.6319C5.76172 62.6303 6.82189 62.6293 7.95253 62.6287C9.08317 62.6284 10.2716 62.6281 11.5178 62.6281C12.7639 62.6277 13.8238 62.5876 14.6974 62.5073C15.571 62.427 16.3578 62.3769 17.058 62.3567C17.7581 62.3368 18.5169 62.2841 19.3342 62.1987C20.1516 62.1132 20.7829 62.0599 21.2281 62.0387C21.6734 62.0175 22.3531 61.9639 23.2673 61.8785C24.1815 61.7927 24.8734 61.7391 25.3428 61.7179C25.8122 61.6963 26.3063 61.6427 26.8252 61.5573C27.344 61.4715 27.7485 61.4179 28.0388 61.3967C28.3291 61.3752 28.5908 61.3215 28.824 61.2361C29.0571 61.1504 29.2832 61.0967 29.502 61.0755C29.7209 61.054 29.9781 61.0004 30.2737 60.9149C30.5693 60.8292 30.8344 60.7756 31.0688 60.7544C31.3033 60.7328 31.5302 60.6792 31.7494 60.5938C31.9686 60.508 32.1859 60.4544 32.4013 60.4332C32.6166 60.4117 32.7513 60.358 32.8051 60.2726C32.859 60.1869 32.9327 60.0529 33.0266 59.8712C33.1203 59.6891 33.1386 59.5352 33.0818 59.4093C33.025 59.2837 32.9092 59.1649 32.7344 59.0531C32.5596 58.9414 32.3701 58.9115 32.1658 58.9638C31.9615 59.0162 31.8338 59.0891 31.7827 59.1826C31.7317 59.276 31.7399 59.4148 31.8074 59.5985C31.8749 59.7825 31.9573 59.9376 32.0544 60.0639C32.1516 60.1901 32.2525 60.3895 32.3571 60.6619C32.4617 60.9345 32.5672 61.1048 32.6736 61.1728C32.7801 61.2409 32.8868 61.2833 32.9936 61.3003C33.1004 61.3174 33.1672 61.3684 33.1942 61.4529C33.2209 61.5374 33.3179 61.6305 33.4852 61.7317C33.6522 61.8332 33.8372 61.8968 34.0395 61.9221C34.2419 61.9475 34.3684 62.0034 34.4191 62.0901C34.4696 62.1765 34.5817 62.2308 34.7548 62.2523C34.9282 62.2741 35.2372 62.2475 35.682 62.1726C36.1265 62.0978 36.4046 62.0108 36.5157 61.9118C36.6269 61.8126 36.7367 61.7509 36.8446 61.7262C36.9528 61.7015 37.0604 61.5653 37.1677 61.3183C37.275 61.0714 37.3822 60.8767 37.4895 60.7348C37.5965 60.5925 37.6636 60.4236 37.6902 60.2273C37.7172 60.0314 37.7741 59.7883 37.8611 59.4986C37.9478 59.2086 38.0024 58.9471 38.0239 58.714C38.0458 58.4808 38.0994 58.255 38.1852 58.0363C38.2709 57.8173 38.3245 57.6002 38.3461 57.385C38.3676 57.1698 38.4209 57.0352 38.5066 56.9813C38.5924 56.9273 38.6457 56.8136 38.6672 56.6396C38.6887 56.4655 38.7421 56.3165 38.8278 56.1928C38.9136 56.0688 39.0472 55.9513 39.2293 55.8402C39.4114 55.729 39.6455 55.6995 39.9317 55.7519C40.2181 55.8045 40.4773 55.8774 40.7095 55.9709C40.9417 56.0643 41.1271 56.1629 41.2655 56.2664C41.4039 56.3701 41.5706 56.435 41.7655 56.4607C41.9608 56.4867 42.123 56.5429 42.2521 56.6299C42.3812 56.7166 42.502 56.8111 42.6144 56.9129C42.7271 57.015 42.8376 57.1187 42.9461 57.2247C43.0544 57.3304 43.1623 57.3966 43.2699 57.4229C43.3772 57.4492 43.4844 57.4659 43.5917 57.4727C43.6986 57.4791 43.7658 57.5234 43.7924 57.6053C43.8194 57.6872 43.9164 57.7386 44.0837 57.7592C44.2507 57.7794 44.3554 57.8324 44.3972 57.9178C44.4389 58.0032 44.5456 58.0566 44.7164 58.0781C44.8876 58.0993 44.9946 58.1529 45.0373 58.2383C45.08 58.3241 45.1869 58.4179 45.3581 58.5194C45.5296 58.6212 45.7169 58.6848 45.9202 58.7101C46.1238 58.7355 46.2506 58.7917 46.3017 58.8784C46.3525 58.9648 46.4645 59.0191 46.638 59.0406C46.8111 59.0624 46.9598 59.1161 47.0831 59.2018C47.2068 59.2876 47.3645 59.3409 47.5559 59.3624C47.7473 59.3839 47.9072 59.4376 48.0354 59.523C48.1635 59.6088 48.3238 59.6624 48.5165 59.6836C48.7092 59.7051 48.8698 59.7587 48.9982 59.8442C49.1267 59.9299 49.2873 59.9836 49.48 60.0048C49.6727 60.0263 49.9537 59.9996 50.3231 59.9245C50.6924 59.8496 50.923 59.7626 51.0155 59.6637C51.1077 59.5644 51.2056 59.3823 51.309 59.1167C51.4125 58.8511 51.5172 58.6851 51.6231 58.6186C51.7294 58.5521 51.7956 58.5508 51.8223 58.6144C51.8489 58.6783 51.9456 58.7178 52.1129 58.7339C52.2803 58.75 52.3846 58.8001 52.4264 58.8842C52.4681 58.9683 52.5748 59.0612 52.7456 59.1627C52.9168 59.2641 53.0639 59.3676 53.1869 59.4732C53.3099 59.5789 53.5071 59.6849 53.7788 59.7915C54.0505 59.8985 54.2606 60.0051 54.4086 60.112C54.5567 60.219 54.7298 60.2861 54.9273 60.3128C55.1252 60.3394 55.2886 60.3963 55.4184 60.4833C55.5481 60.5703 55.7094 60.6246 55.9024 60.6464C56.0954 60.668 56.4972 60.6416 57.1074 60.5668C57.7176 60.492 58.1393 60.4049 58.3722 60.306C58.605 60.2068 58.7505 60.0648 58.8086 59.8795C58.8671 59.6942 58.9034 59.1768 58.9178 58.3276C58.9326 57.4781 58.9817 56.7067 59.0656 56.0126C59.1497 55.3186 59.2021 54.8044 59.2229 54.4704C59.2441 54.1361 59.2971 53.8871 59.3829 53.7234C59.4683 53.5596 59.6022 53.3367 59.784 53.055C59.9661 52.773 60.12 52.5569 60.2459 52.4059C60.3714 52.2553 60.6107 52.0408 60.9633 51.762C61.316 51.4835 61.5765 51.3496 61.7447 51.3602C61.9134 51.3708 62.099 51.498 62.3017 51.7414C62.5043 51.9852 62.671 52.1371 62.802 52.1981C62.9331 52.2592 63.0953 52.3773 63.2886 52.5533C63.4819 52.729 63.6027 52.879 63.6509 53.0033C63.6994 53.1276 63.7296 53.2455 63.7418 53.3566C63.7537 53.468 63.8015 53.5377 63.8847 53.5653C63.9682 53.5933 64.1407 53.7712 64.4024 54.0994C64.6638 54.4277 64.8678 54.6326 65.0133 54.7145C65.1591 54.7967 65.3306 54.9685 65.5275 55.2296C65.7247 55.4911 65.8878 55.6947 66.0172 55.8402C66.147 55.986 66.3082 56.117 66.5012 56.2339C66.6939 56.3505 66.8147 56.4636 66.8629 56.5731C66.9111 56.6826 66.9814 56.7912 67.0739 56.8987C67.1661 57.0063 67.3042 57.1139 67.4879 57.2209C67.6716 57.3281 67.987 57.596 68.4344 58.0241C68.8817 58.4526 69.2418 58.8004 69.5141 59.0682C69.7865 59.3358 70.037 59.5834 70.2657 59.8108C70.4946 60.0382 70.6777 60.2206 70.8152 60.3577C70.9526 60.4949 71.0384 60.6208 71.0727 60.7354C71.1071 60.8501 71.2089 60.9618 71.3782 61.0707C71.5474 61.1796 71.6531 61.2878 71.6952 61.3954C71.7376 61.503 71.8843 61.6906 72.1358 61.9584C72.3873 62.226 72.625 62.4338 72.8482 62.5808C73.0717 62.7279 73.2515 62.8603 73.3877 62.9772C73.5239 63.0944 73.7294 63.2881 74.0044 63.5582C74.2793 63.8283 74.4913 63.9972 74.6403 64.0646C74.7893 64.1324 74.9627 64.2949 75.1606 64.5528C75.3584 64.8104 75.5222 64.9716 75.652 65.0359C75.7817 65.1004 75.8626 65.1807 75.8951 65.2774C75.9275 65.3737 76.0682 65.5542 76.3174 65.8192C76.5663 66.0841 76.7619 66.29 76.9045 66.4365C77.0471 66.5832 77.1762 66.7149 77.2922 66.8318C77.4081 66.9487 77.5208 67.1019 77.63 67.2917C77.7392 67.4815 77.8478 67.6405 77.9554 67.7683C78.063 67.8959 78.1301 68.0561 78.1571 68.2485C78.184 68.4412 78.1606 68.6015 78.0871 68.7299C78.0135 68.8584 77.9274 68.9387 77.8288 68.9708C77.7302 69.0029 77.2671 68.983 76.4395 68.9107C75.6118 68.8385 74.8535 68.7129 74.1649 68.5343C73.4764 68.3554 72.9657 68.2039 72.633 68.0789C72.3003 67.954 71.9717 67.8756 71.6476 67.8445C71.3236 67.8133 70.9607 67.7134 70.5582 67.5451C70.1561 67.3765 69.6236 67.2314 68.9611 67.109C68.2985 66.9866 67.8444 66.8697 67.5984 66.7589C67.3523 66.6481 67.0382 66.5386 66.6554 66.4307C66.2729 66.3225 65.873 66.1747 65.4562 65.9872C65.0393 65.7996 64.6985 65.6422 64.4339 65.515C64.1689 65.3879 63.9232 65.3085 63.6965 65.2767C63.4697 65.2449 63.288 65.1849 63.1508 65.0966C63.0137 65.0082 62.848 64.953 62.653 64.9311C62.4584 64.909 62.3363 64.855 62.2878 64.7693C62.239 64.6835 62.1684 64.5898 62.0759 64.4879C61.9837 64.3861 61.9259 64.2422 61.9028 64.0563C61.8796 63.8703 61.9053 63.6336 61.9798 63.3462C62.0544 63.0587 62.1411 62.8792 62.24 62.8073C62.3389 62.7356 62.4407 62.6505 62.5457 62.5523C62.6508 62.454 63.0378 62.2722 63.7061 62.0066C64.3748 61.7413 64.8729 61.5351 65.2008 61.3887C65.5284 61.2419 65.8136 61.1504 66.0561 61.1134C66.2986 61.0768 66.6108 61.0139 66.9926 60.9243C67.3742 60.835 67.7332 60.7389 68.0698 60.6362C68.4061 60.5334 68.857 60.4293 69.4229 60.3234C69.9888 60.2174 70.503 60.1111 70.9658 60.0041C71.4283 59.8975 71.8779 59.7905 72.3147 59.6836C72.7515 59.5766 73.2657 59.4694 73.8566 59.3624C74.4476 59.2555 74.9775 59.1084 75.4464 58.9208C75.9153 58.7336 76.3287 58.6163 76.6868 58.5698C77.0449 58.5229 77.3089 58.4535 77.4788 58.3613C77.6487 58.2695 77.8751 58.212 78.1584 58.1889C78.4416 58.1657 78.6591 58.1115 78.81 58.0254C78.9613 57.9393 79.136 57.8854 79.3345 57.8639C79.5326 57.8423 79.6967 57.789 79.8268 57.7033C79.9566 57.6175 80.4393 57.4434 81.2746 57.1814C82.11 56.919 82.6322 56.715 82.841 56.5689C83.0497 56.4231 83.2607 56.2917 83.4734 56.1751C83.6863 56.0582 83.8996 55.905 84.1135 55.7152C84.327 55.5254 84.4205 55.4069 84.3938 55.3594C84.3668 55.3122 84.31 55.2823 84.223 55.2704C84.1359 55.2585 83.9612 55.211 83.6985 55.1278C83.4358 55.0446 83.1914 54.9926 82.9653 54.9717C82.7388 54.9509 82.5574 54.8979 82.4206 54.8124C82.2838 54.7267 82.1177 54.6734 81.9231 54.6519C81.7281 54.6307 81.3254 54.577 80.7149 54.4916C80.104 54.4058 79.6421 54.3522 79.3287 54.331C79.0155 54.3095 78.432 54.2954 77.578 54.288L76.2975 54.2774'
    stroke='black'
    strokeWidth='2.56934'
    strokeLinecap='round'
    strokeLinejoin='round'
  ></path>
));

SignatureLine.displayName = 'SignatureLine';

export const SignatureDot = forwardRef<SVGPathElement>((props, ref) => (
  <path
    ref={ref}
    className='signature__path'
    d='M31.4015 48.8175H31.0803'
    stroke='black'
    strokeWidth='2.56934'
    strokeLinecap='round'
    strokeLinejoin='round'
    strokeDasharray='0.32 0.32'
  ></path>
));

SignatureDot.displayName = 'SignatureDot';
